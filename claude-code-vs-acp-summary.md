# Claude Code é›†æˆåˆ†ææ€»ç»“

## æ ¸å¿ƒå‘ç° ğŸ”

### Claude Code != ACP

**é‡è¦**ï¼šIDEA çš„ Claude Code å®ç° **ä¸ä½¿ç”¨ ACP åè®®**ï¼

å®ƒä½¿ç”¨çš„æ˜¯ **è‡ªå®šä¹‰ JSON æµå¼åè®®**ï¼Œé€šè¿‡ stdio ä¸å¤–éƒ¨ `claude-code` äºŒè¿›åˆ¶é€šä¿¡ã€‚

## æ¶æ„å¯¹æ¯”

### ACP Agents (Copilot/Gemini/Kimi)

```
åº”ç”¨ â†’ ACP Client â†’ JSON-RPC over stdio â†’ Agent CLI (å¤–éƒ¨è¿›ç¨‹)
                    â†“
            æ ‡å‡† ACP åè®®
```

### Claude Code (IDEA å®ç°)

```
åº”ç”¨ â†’ ClaudeCodeClient â†’ è‡ªå®šä¹‰ JSON over stdio â†’ claude-code äºŒè¿›åˆ¶
                          â†“
                  éæ ‡å‡†åè®®
```

## å…³é”®å·®å¼‚

| æ–¹é¢ | ACP Agents | Claude Code |
|------|------------|-------------|
| **åè®®** | æ ‡å‡† ACP (JSON-RPC) | è‡ªå®šä¹‰ JSON æµ |
| **å®‰è£…** | ç”¨æˆ·è‡ªè¡Œå®‰è£… CLI | åº”ç”¨å†…è‡ªåŠ¨ä¸‹è½½äºŒè¿›åˆ¶ |
| **é›†æˆéš¾åº¦** | âœ… ç®€å•ï¼ˆå·²æœ‰åŸºç¡€è®¾æ–½ï¼‰ | âš ï¸ ä¸­ç­‰ï¼ˆéœ€æ–°é€‚é…å±‚ï¼‰ |
| **å·¥ä½œé‡** | 7è¡Œä»£ç  | ä¼°è®¡ 3-5 å¤© |

## IDEA å®ç°çš„æ ¸å¿ƒç»„ä»¶

### 1. ClaudeCodeProcessHandler
- å¯åŠ¨ `claude-code` è¿›ç¨‹
- è§£æ stdout çš„ JSON æ¶ˆæ¯
- å‘é€åˆ° Kotlin Channel

### 2. æ¶ˆæ¯ç±»å‹
```kotlin
sealed class ClaudeMessage {
    SystemInitMessage    // ç³»ç»Ÿåˆå§‹åŒ–
    UserMessage          // ç”¨æˆ·è¾“å…¥
    AssistantMessage     // AI å›å¤ï¼ˆå«å·¥å…·è°ƒç”¨ï¼‰
    ControlRequestMessage // æ§åˆ¶å‘½ä»¤
}
```

### 3. è¿›ç¨‹å¯åŠ¨
```bash
claude-code -p --verbose --output-format stream-json \
    --permission-mode approve_all \
    --model claude-sonnet-4 \
    --mcp-config /path/to/mcp.json
```

### 4. ç¯å¢ƒå˜é‡
```bash
ANTHROPIC_API_KEY=sk-ant-...
ANTHROPIC_BASE_URL=https://api.anthropic.com
```

## é›†æˆæ–¹æ¡ˆå»ºè®®

### æ–¹æ¡ˆ Aï¼šç›´æ¥é›†æˆ Claude Code äºŒè¿›åˆ¶ â­

**ä¼˜ç‚¹ï¼š**
- âœ… åŠŸèƒ½å®Œæ•´ï¼ˆå·¥å…·è°ƒç”¨ã€MCPã€Thinkingï¼‰
- âœ… å®˜æ–¹æ”¯æŒ
- âœ… IDEA å·²éªŒè¯

**ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦ä¸‹è½½å¤–éƒ¨äºŒè¿›åˆ¶
- âŒ é ACP åè®®ï¼ˆéœ€æ–°é€‚é…å±‚ï¼‰
- âŒ å·¥ä½œé‡ï¼š3-5 å¤©

**å®ç°æ­¥éª¤ï¼š**
1. ä¸‹è½½æœåŠ¡ï¼ˆè·å– claude-code äºŒè¿›åˆ¶ï¼‰
2. è¿›ç¨‹ç®¡ç†å™¨ï¼ˆå¯åŠ¨å’Œç®¡ç†è¿›ç¨‹ï¼‰
3. JSON æ¶ˆæ¯è§£æå™¨
4. æ¸²æŸ“é€‚é…å™¨ï¼ˆé€‚é…åˆ° CodingAgentRendererï¼‰
5. é…ç½®é›†æˆ

### æ–¹æ¡ˆ Bï¼šç­‰å¾…å®˜æ–¹ ACP æ”¯æŒ

**ä¼˜ç‚¹ï¼š**
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„
- âœ… æ— éœ€æ–°ä»£ç 

**ç¼ºç‚¹ï¼š**
- âŒ ä¸ç¡®å®šä½•æ—¶æ”¯æŒ
- âŒ ç›®å‰æ— æ³•ä½¿ç”¨

## æ‰€éœ€æ–°å¢ä»£ç ç»“æ„

```
mpp-core/src/jvmMain/kotlin/cc/unitmesh/agent/claude/
â”œâ”€â”€ ClaudeCodeClient.kt              # å®¢æˆ·ç«¯ï¼ˆç±»ä¼¼ AcpClientï¼‰
â”œâ”€â”€ ClaudeCodeSession.kt             # ä¼šè¯ç®¡ç†
â”œâ”€â”€ ClaudeCodeProcessHandler.kt      # è¿›ç¨‹å¤„ç†
â”œâ”€â”€ ClaudeCodeDownloadService.kt     # äºŒè¿›åˆ¶ä¸‹è½½
â””â”€â”€ protocol/
    â”œâ”€â”€ ClaudeMessage.kt
    â”œâ”€â”€ UserMessage.kt
    â”œâ”€â”€ AssistantMessage.kt
    â””â”€â”€ Content.kt

mpp-ui/src/commonMain/kotlin/cc/unitmesh/devins/ui/compose/agent/claude/
â”œâ”€â”€ ClaudeCodeRenderer.kt            # æ¸²æŸ“é€‚é…å™¨
â””â”€â”€ ClaudeCodeConnectionProvider.kt  # è¿æ¥æä¾›è€…
```

## å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ |
|------|------|------|
| Phase 1 | åŸºç¡€æ¶æ„ï¼ˆClientã€è¿›ç¨‹ç®¡ç†ï¼‰ | 2å¤© |
| Phase 2 | åè®®å®ç°ï¼ˆæ¶ˆæ¯å®šä¹‰ã€è§£æï¼‰ | 1å¤© |
| Phase 3 | æ¸²æŸ“é›†æˆï¼ˆé€‚é…å™¨ï¼‰ | 1å¤© |
| Phase 4 | ä¸‹è½½æœåŠ¡ï¼ˆäºŒè¿›åˆ¶ç®¡ç†ï¼‰ | 1å¤© |
| Phase 5 | UI é›†æˆï¼ˆé…ç½®ç•Œé¢ï¼‰ | 1å¤© |
| Phase 6 | æµ‹è¯•å’Œæ–‡æ¡£ | 1å¤© |
| **æ€»è®¡** | | **5-7å¤©** |

## ä¸ Copilot é›†æˆå¯¹æ¯”

| é¡¹ç›® | Copilot (ACP) | Claude Code |
|------|---------------|-------------|
| åè®®å…¼å®¹ | âœ… å®Œå…¨å…¼å®¹ | âŒ éœ€æ–°é€‚é…å±‚ |
| ä»£ç ä¿®æ”¹ | âœ… 7è¡Œ | âš ï¸ ~1000è¡Œ |
| å·¥ä½œé‡ | âœ… 1å°æ—¶ | âš ï¸ 5-7å¤© |
| æµ‹è¯•éªŒè¯ | âœ… å·²å®Œæˆ | â³ éœ€æ–°æµ‹è¯• |
| äºŒè¿›åˆ¶ç®¡ç† | âœ… ç”¨æˆ·å®‰è£… | âš ï¸ éœ€ä¸‹è½½æœåŠ¡ |

## å»ºè®®

### çŸ­æœŸï¼ˆç°åœ¨ï¼‰

1. âœ… **å®Œæˆ Copilot é›†æˆ** - å·²å®Œæˆ
2. ğŸ“‹ **ç ”ç©¶ Claude Code äºŒè¿›åˆ¶**
   - ä¸‹è½½åœ°å€
   - è®¸å¯è¯è¦æ±‚
   - ç‰ˆæœ¬ç®¡ç†

### ä¸­æœŸï¼ˆ1-2å‘¨ï¼‰

3. ğŸ”¨ **å®ç° Claude Code åŸºç¡€**
   - å‚è€ƒ IDEA å®ç°
   - åˆ›å»ºåŸºç¡€æ¶æ„
   - MVP éªŒè¯

### é•¿æœŸï¼ˆ1ä¸ªæœˆï¼‰

4. ğŸš€ **å®Œæ•´åŠŸèƒ½**
   - å·¥å…·è°ƒç”¨
   - MCP æ”¯æŒ
   - ä¸ ACP agents ç»Ÿä¸€ä½“éªŒ

## ç–‘é—®å’Œé£é™©

### éœ€è¦ç¡®è®¤

1. â“ `claude-code` äºŒè¿›åˆ¶æ˜¯å¦å…¬å¼€å¯ç”¨
2. â“ æ˜¯å¦éœ€è¦ç‰¹æ®Šè®¸å¯è¯
3. â“ ä¸‹è½½åœ°å€å’Œç‰ˆæœ¬ç®¡ç†æ–¹å¼
4. â“ æ˜¯å¦æœ‰æ–‡æ¡£è¯´æ˜åè®®æ ¼å¼

### æŠ€æœ¯é£é™©

1. âš ï¸ JSON æµå¼è§£æçš„å¤æ‚æ€§
2. âš ï¸ è·¨å¹³å°å…¼å®¹æ€§ï¼ˆmacOS/Linux/Windowsï¼‰
3. âš ï¸ ç»´æŠ¤æˆæœ¬ï¼ˆéæ ‡å‡†åè®®å¯èƒ½å˜åŒ–ï¼‰

## å‚è€ƒèµ„æ–™

- [é›†æˆæ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](claude-code-integration-plan.md)
- [IDEA å®ç°æºç ](file:///Users/phodal/Downloads/ml-llm/lib/ml-llm/sources/com/intellij/ml/llm/agents/claude/code/)
- [é¡¹ç›® ACP å®ç°](../mpp-core/src/jvmMain/kotlin/cc/unitmesh/agent/acp/)

## ç»“è®º

1. **Claude Code ä¸æ˜¯ ACP** - éœ€è¦å•ç‹¬çš„é€‚é…å±‚
2. **å®ç°å¯è¡Œ** - IDEA å·²éªŒè¯ï¼Œå¯ä»¥å‚è€ƒ
3. **å·¥ä½œé‡è¾ƒå¤§** - ç›¸æ¯” Copilot çš„ 7 è¡Œä»£ç ï¼Œéœ€è¦çº¦ 5-7 å¤©
4. **å»ºè®®ä¼˜å…ˆçº§**ï¼š
   - âœ… é«˜ä¼˜å…ˆçº§ï¼šCopilotï¼ˆå·²å®Œæˆï¼‰
   - â³ ä¸­ä¼˜å…ˆçº§ï¼šClaude Codeï¼ˆå¦‚æœäºŒè¿›åˆ¶å¯ç”¨ï¼‰
   - â³ ä½ä¼˜å…ˆçº§ï¼šå…¶ä»– ACP agentsï¼ˆClaude CLIã€Codex ç­‰ï¼‰

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šéœ€è¦å…ˆç¡®è®¤ `claude-code` äºŒè¿›åˆ¶çš„å¯ç”¨æ€§å’Œè·å–æ–¹å¼ã€‚
