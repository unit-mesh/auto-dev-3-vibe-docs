# WebEdit Agent 使用指南

## 功能概览

WebEdit Agent 是一个强大的网页浏览和 DOM 分析工具，集成了 AI 助手功能，让你可以：

1. **浏览网页** - 在应用内嵌入式浏览器中访问任何网站
2. **选择元素** - 使用选择模式点击并选中页面上的任何 DOM 元素
3. **查看 DOM 树** - 在侧边栏中查看完整的 DOM 结构（支持 Shadow DOM）
4. **AI 问答** - 向 AI 提问关于页面内容或选中元素的问题

## 界面布局

```
┌─────────────────────────────────────────────────────┐
│ [×] [←] [→] [↻] [URL输入框...] [👆] [🌳]           │ ← 工具栏
├─────────────────────────────────┬───────────────────┤
│                                 │  DOM Tree         │
│                                 │  ├─ html          │
│       WebView 区域              │  │  ├─ head       │
│                                 │  │  └─ body       │
│       (显示网页内容)             │  │     ├─ div    │ ← DOM 树侧边栏
│                                 │  │     ├─ nav     │   (可隐藏)
│                                 │  │     └─ main    │
│                                 │                   │
├─────────────────────────────────┴───────────────────┤
│ [输入框: 询问关于页面的问题...] [发送]             │ ← AI 聊天输入
└─────────────────────────────────────────────────────┘
```

## 基本操作

### 1. 打开 WebEdit

在 AutoDev 中选择 "WebEdit" 代理类型或工具。

### 2. 浏览网页

**方法 A: 输入 URL**
1. 在顶部 URL 输入框中输入网址
   - 支持格式：`https://example.com` 或 `example.com`
   - 会自动添加 `https://` 前缀（如果缺失）
2. 按 Enter 或点击输入框外区域开始导航

**方法 B: 使用导航按钮**
- **[←]** 后退 - 返回上一页
- **[→]** 前进 - 前往下一页
- **[↻]** 刷新 - 重新加载当前页面

### 3. 选择 DOM 元素

1. 点击工具栏的 **[👆] 选择模式** 按钮激活选择模式
   - 按钮变为高亮蓝色表示已激活
   - 页面右上角显示 "Selection Mode" 标签

2. 鼠标悬停在页面元素上
   - 元素会以蓝色边框高亮显示
   - 显示标签名称（如 `div`, `button`, `a`）

3. 点击元素以选中
   - 元素边框变为绿色
   - 页面左下角显示 "Selected: tagName#id.class"
   - DOM 树中对应节点也会高亮

4. 再次点击 **[👆]** 按钮退出选择模式

### 4. 使用 DOM 树侧边栏

**显示/隐藏侧边栏**
- 点击工具栏的 **[🌳] DOM 树** 按钮

**浏览 DOM 结构**
- 树形显示完整的页面结构
- 展开/折叠节点查看子元素
- 支持 Shadow DOM（标记为 `[shadow-host]` 或 `[shadow]`）

**搜索元素**
- 使用侧边栏顶部的搜索框
- 输入标签名、ID 或 class 进行过滤

**交互操作**
- **点击节点** - 高亮并滚动到页面中对应的元素
- **鼠标悬停** - 临时高亮页面中的元素

### 5. AI 问答

在底部聊天输入框中输入问题，然后点击发送或按 Enter。

**问题示例：**

**关于页面整体：**
- "这个页面的主要内容是什么？"
- "页面使用了哪些技术栈？"
- "总结一下这个页面的结构"

**关于选中的元素：**
1. 先使用选择模式选中一个元素
2. 然后提问：
   - "这个元素是做什么用的？"
   - "这个按钮的功能是什么？"
   - "这个表单需要哪些字段？"
   - "如何用 CSS 选择器定位这个元素？"

**AI 会自动包含以下上下文：**
- 当前页面标题和 URL
- 选中元素的标签、选择器、文本内容和属性（如果有选中）

## 高级功能

### Shadow DOM 支持

WebEdit 完全支持 Shadow DOM：
- 可以穿透 Shadow Root 选择内部元素
- DOM 树显示 Shadow DOM 结构
- 选择器会正确处理 Shadow 边界

### 错误处理

如果遇到问题：
- 页面顶部会显示红色错误提示
- 常见错误：
  - "Invalid URL" - URL 格式不正确
  - "Failed to navigate" - 网络问题或页面无法访问
  - "LLM service is not available" - AI 服务未配置

### 性能优化

- WebEdit 会自动注入必要的 JavaScript 脚本
- DOM 树在页面加载完成后自动提取
- MutationObserver 监听页面变化并实时更新

## 使用技巧

1. **快速定位元素**
   - 使用 DOM 树的搜索功能比手动翻页更快
   - 鼠标悬停可以预览元素位置

2. **分析复杂组件**
   - 选中一个组件后，DOM 树会定位到该节点
   - 可以查看子元素和父元素的关系

3. **提取信息**
   - 选中元素后询问 AI 关于元素的问题
   - AI 可以帮助生成选择器、分析结构等

4. **调试网页**
   - 使用选择模式快速定位有问题的元素
   - 查看 DOM 树了解结构
   - 向 AI 询问可能的解决方案

## 快捷键

- **Enter** (在 URL 输入框) - 导航到 URL
- **Enter** (在聊天输入框) - 发送消息
- **Esc** - 退出选择模式 (计划中)

## 注意事项

1. **跨域限制**
   - 某些网站可能阻止在 iframe 中加载
   - CORS 限制可能影响某些功能

2. **JavaScript 依赖**
   - 需要网站允许执行 JavaScript
   - 某些网站的 CSP 策略可能影响功能

3. **隐私和安全**
   - WebEdit 不会收集或存储浏览数据
   - AI 问答会将页面信息发送到 LLM 服务

4. **LLM 服务**
   - 需要先配置 LLM 服务才能使用 AI 问答
   - 如果未配置，聊天输入框会被禁用

## 故障排除

### 页面无法加载
- 检查 URL 是否正确
- 尝试在外部浏览器中打开该 URL
- 某些网站禁止在嵌入式浏览器中显示

### 选择模式不工作
- 确保页面已完全加载
- 刷新页面重试
- 检查浏览器控制台是否有错误

### DOM 树为空
- 等待页面完全加载
- 刷新页面
- 某些动态加载的内容可能需要时间

### AI 不回复
- 检查 LLM 服务是否已配置
- 查看错误提示信息
- 确认网络连接正常

## 反馈和支持

如果遇到问题或有功能建议：
- 提交 Issue: https://github.com/phodal/auto-dev/issues
- 参考实现文档: `docs/webedit/implementation-summary.md`
